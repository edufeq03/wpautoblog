{% extends "admin/base_admin.html" %}

{% block title %}Gestão de Utilizadores{% endblock %}

{% block content %}
<div class="bg-[#121214] border border-zinc-800 rounded-2xl overflow-hidden shadow-2xl">
    <div class="p-6 border-b border-zinc-800 flex justify-between items-center">
        <h3 class="text-lg font-semibold text-white">Utilizadores Registados</h3>
        <span class="px-3 py-1 bg-blue-600/10 text-blue-400 text-xs font-bold rounded-full border border-blue-600/20">
            {{ users|length }} Total
        </span>
    </div>
    
    <div class="overflow-x-auto">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="bg-zinc-900/50 text-zinc-500 text-xs uppercase tracking-wider">
                    <th class="px-6 py-4 font-medium">Utilizador</th>
                    <th class="px-6 py-4 font-medium">Plano Atual</th>
                    <th class="px-6 py-4 font-medium">Créditos</th>
                    <th class="px-6 py-4 font-medium text-right">Ações</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-zinc-800">
                {% for user in users %}
                <tr class="hover:bg-zinc-800/30 transition-colors group">
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 rounded-full bg-zinc-800 flex items-center justify-center text-zinc-400 group-hover:bg-blue-600/20 group-hover:text-blue-400 transition-colors">
                                <i class="fas fa-user text-sm"></i>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-zinc-200">{{ user.email }}</p>
                                <p class="text-[10px] text-zinc-500 italic">ID: #{{ user.id }}</p>
                            </div>
                        </div>
                    </td>
                    <td class="px-6 py-4">
                        <span class="px-3 py-1 rounded-lg text-xs font-bold 
                            {% if user.plan.name == 'VIP' %} bg-purple-500/10 text-purple-400 border border-purple-500/20
                            {% elif user.plan.name == 'Pro' %} bg-blue-500/10 text-blue-400 border border-blue-500/20
                            {% else %} bg-zinc-700/30 text-zinc-400 border border-zinc-700/50 {% endif %}">
                            {{ user.plan.name if user.plan else 'Sem Plano' }}
                        </span>
                    </td>
                    <td class="px-6 py-4">
                        <div class="flex items-center gap-2 text-sm text-zinc-300">
                            <i class="fas fa-coins text-yellow-500/50"></i>
                            {{ user.credits }}
                        </div>
                    </td>
                    <td class="px-6 py-4 text-right">
                        <button onclick="toggleModal('modal-user-{{ user.id }}')" class="text-zinc-500 hover:text-white transition-colors p-2">
                            <i class="fas fa-ellipsis-v"></i>
                        </button>

                        <div id="modal-user-{{ user.id }}" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/60 backdrop-blur-sm p-4">
                            <div class="bg-[#18181b] border border-zinc-800 w-full max-w-md rounded-2xl shadow-2xl p-6 text-left">
                                <h4 class="text-lg font-bold text-white mb-4">Gerir Utilizador: {{ user.email }}</h4>
                                
                                <form action="{{ url_for('admin.set_user_plan', id=user.id) }}" method="POST" class="space-y-4">
                                    <div>
                                        <label class="block text-xs font-semibold text-zinc-500 uppercase mb-2">Alterar Plano</label>
                                        <select name="plan_id" class="w-full bg-zinc-900 border border-zinc-800 rounded-xl p-3 text-zinc-300 focus:ring-2 focus:ring-blue-500 outline-none">
                                            {% for plan in plans %}
                                                <option value="{{ plan.id }}" {% if user.plan_id == plan.id %}selected{% endif %}>
                                                    {{ plan.name }} (R$ {{ plan.price }})
                                                </option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                    
                                    <div class="flex gap-3 pt-4">
                                        <button type="button" onclick="toggleModal('modal-user-{{ user.id }}')" class="flex-1 bg-zinc-800 text-zinc-300 py-3 rounded-xl font-bold hover:bg-zinc-700 transition">Cancelar</button>
                                        <button type="submit" class="flex-1 bg-blue-600 text-white py-3 rounded-xl font-bold hover:bg-blue-500 transition shadow-lg shadow-blue-600/20">Guardar</button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    function toggleModal(modalId) {
        const modal = document.getElementById(modalId);
        modal.classList.toggle('hidden');
    }
</script>
{% endblock %}